# auto-video-ingest
Bash scripts (with udev rules) to automatically ingest video files to a target directory/server.

# Setup

1) Clone the repository to a local folder. In this example `/opt/auto-video-ingest` will be used.
1) Configure the `DESKTOP_USER` variable in `/opt/auto-video-ingest/scripts/auto-video-ingest.cfg` to the primary user for which all the magic will run.
1) Create udev rules in `/etc/udev/rules.d/99-auto-video-ingest.rules`
   ```
   KERNEL=="mmcblk0p[0-9]", ACTION=="add", SUBSYSTEM=="block", RUN+="/bin/bash /opt/auto-video-ingestscripts/scripts/auto-video-ingest-hook $kernel"
   KERNEL=="sd*", ACTION=="add", SUBSYSTEM=="block", RUN+="/bin/bash /opt/auto-video-ingest/scripts/auto-video-ingest-hook $kernel"
   ```
1) Add the auto-video-ingest-watchdog to your gnome startup applications
1) Create configuration in  `/opt/auto-video-ingest/scripts/auto-video-ingest.cfg` (based on auto-video-ingest.cfg.example)
1) Create a `auto-video-ingest.cfg` file on all drives you with to auto ingest with the following content (example!):
   ```
   NAME="Fatshark HDO"     # how should the target folder be named (i.e. camera name) and can contain spaces
   SRCDIRS="DCIM/100DSCIM" # where do the files you wish to copy reside (i.e. DCIM). You can add multiple folders. Don't use spaces in names!
   EXCLUDES="*.BIN *.XML"  # do not copy files matching the excludes. You can add multiple excludes but need to add at least one. Don't use spaces in names!
   SUBFOLDER="RC"          # in which subfolder should the files be copied (i.e. RC)
   ```
1) Ubuntu disabled media auto mounting with 21.10. To reenable it, run `gsettings set org.gnome.desktop.media-handling automount true` and restart gnome.


# Components and how it works

## Udev rules
... trigger the `auto-video-ingest-hook` script. They obvously run as root.

## `auto-video-ingest-hook`
This scripts writes the detected device into a trigger file for the watchdog. Those files are crated in a way that a normal user can read and remove them.

## `auto-video-ingest-watchdog`
This script watches for trigger files generated by auto-video-ingest-hook and calls the worker script auto-video-ingest

## `auto-video-ingest`
This script is the main "brain" which copies the files from your disk to the target. This runs as the intended user.

## `auto-video-ingest.cfg(.example)`
Some configurations for the script. The `.example` is in the repository, so that you can pull the source from GitHub without overriding your config.
